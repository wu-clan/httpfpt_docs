## 变量定义

- 常规变量

  以下三种变量统称为常规变量

    - global: 全局变量，仅在 data 目录下的 `global_vars.yaml` 文件中以键值对形式进行定义
    - env: 环境变量，在测试用例依赖的环境文件中以键值对的形式进行定义
    - cache: 缓存变量，在同一 `python包` 下运行测试用例时，在系统内存中定义

- hook（钩子函数）

  仅在 data 目录下的 hooks.py 文件中定义，根据定义结构在用例数据文件中使用

## 变量存储

- env：在当前测试用例数据所调用的测试环境文件中进行持久化写入，键值不会重复，新值覆盖旧值
- global: 在全局变量文件中进行持久化写入，键值不会重复，新值覆盖旧值
- cache：在同一 `python包` 目录下，写入所有测试用例运行过程的内存中，不会持久化，同一 `python包` 目录下所有测试用例运行结束后自动清除

::: warning
变量持久化写入会冲刷掉手写注释内容
:::

## 变量表达式

命名规则: `a-zA-Z_`

- 常规变量：全局可用

   ```text
   ${var} 或 $var
   ```

- [关联测试用例变量](params_desc.md#testcase)：仅对当前单个测试用例可用

   ```text
   ^{var} 或 ^var
   ```

- hook：全局可用

   ```text
   ${func()}
   ```

- SQL 专属变量：仅在 SQL 语句中可用

   ```text
   :{var} 或 :var
   ```

## 变量替换逻辑

::: warning
变量替换逻辑与变量语法密切相关
:::

- 常规变量

  请求数据解析时，会立即自动寻找所有常规变量并立即替换，寻找变量优先级为：cache > env > global，找到变量自动替换数据，未找到抛出异常

- 关联变量

  默认在 cache 中存储关联变量

  如果通过关联用例参数进行了关联变量设置，在关联测试用例执行后，会立即重新对当前测试用例数据进行变量替换操作（仅处理关联测试用例变量语法）

  ::: warning
  关联变量仅对当前单个测试用例可用，不能与其他测试用例共享（一个测试步骤相当于一个测试用例），当前用例运行后将自动清除；
  虽然此变量不可全局使用，但依然不能与其他变量名进行重复命名
  :::

- SQL 变量

  此变量为特殊变量，仅在 SQL 被执行时才进行变量替换，如果在此之前，进行了 SQL 设置变量，这会很有帮助（比如，你执行了一条插入
  SQL，然后将插入 SQL 新增的 ID 设置为变量，此时，你就可以精准的对插入数据进行额外操作），变量替换时的优先级与常规变量相同
